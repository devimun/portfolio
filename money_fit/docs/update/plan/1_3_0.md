<!-- @format -->

# 1.3.0 업데이트 로그

## 배경 요약

- 운영 데이터(2025-09-25~10-22) 분석 결과 설치 대비 튜토리얼 완료율이 30% 미만으로 급락, 튜토리얼 완료 시 핵심 기능 전환율은 34% 수준으로 유지됨.
- 상위 경쟁 앱은 첫 실행 즉시 메인 화면을 보여주고 테마 커스터마이징을 제공, 반면 머니핏은 오픈 앱 광고 + 전체 온보딩 플로우로 흐름이 단절되고 다크 모드만 지원.
- README는 여전히 1.2.x 기능 세트(온보딩 포함)를 안내하고 있으며, 앱 버전도 `pubspec.yaml` 기준 1.2.5+15에 머물러 있어 1.3.0 계획 대비 문서/빌드 간극 존재.

## 업데이트 목표

1. **핵심 경험 즉시 제공**: 설치 직후 홈 핵심 카드로 이동, 필요한 설정은 홈/세팅에서 온디맨드 모달로 처리.
2. **UX 흐름 단절 최소화**: 오픈 앱 광고 제거, 필수 전면 광고는 탐색 전환 시점으로 재배치하고 사용자 피로도를 낮춤.
3. **UI 커스터마이징 확장**: 테마 팔레트 + 다크 모드 설정을 분리하고, 사용자가 메인 색상을 직접 고를 수 있는 실험적 샌드박스 도입.
4. **측정 및 학습 루프**: 개선 후 마케팅 캠페인을 재개하고 Analytics/Firebase Remote Config로 A/B 데이터를 회수.

## 작업 계획

### 1. 온보딩 제거 & 핵심 경험 직행

#### 작업 계획 ID 표

| ID   | 항목                               |
| ---- | ---------------------------------- |
| wp_1 | SplashScreen 단일 리스너 전환      |
| wp_2 | `/budget_setup` 온디맨드 모달 전환 |
| wp_3 | README/스토어 온보딩 문구 정리     |

| ID   | 문제 / 개선 포인트                                                                                                                                                                                                                                                                                                                                 | 근거                                                                                                     | 작업 날짜  | 해결 상태 |
| ---- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- | ---------- | --------- |
| wp_1 | 기존 `ref.listen`/`next.when` 구조는 동작하지만 `build` 타이밍마다 리스너를 붙여야 했으므로, `ConsumerStatefulWidget` + `initState`에서 `appInitializerProvider.future` → `homeViewModelProvider.future`를 차례로 `read`해 초기화 완료 시점에 단 한 번만 라우팅하도록 단순화. 실패 시 `FlutterError.reportError` 후 `/budget_setup`으로 안전 이탈. | `lib/features/auth/view/splash_screen.dart:1-54`                                                         | 2025-11-07 | o         |
| wp_2 | `/budget_setup`가 전용 라우트로 고정돼 홈 핵심 카드와 단절되므로, 홈 탭에서 호출 가능한 모달과 상단 요약 가이드를 제공해 초기 전환을 온디맨드 흐름으로 축소해야 함.                                                                                                                                                                                | `lib/core/router/app_router.dart:44-57`<br>`lib/features/onboarding/view/onboarding_screen.dart:120-140` | -          | x         |
| wp_3 | README/스토어 메타데이터가 여전히 온보딩 플로우를 안내하므로 홈 카드 중심 메시지로 문구를 갱신하고 튜토리얼 안내를 제거해야 함.                                                                                                                                                                                                                    | `README.md:53-122`                                                                                       | -          | x         |

### 2. 광고 및 알림 흐름 다듬기

#### 작업 계획 ID 표

| ID   | 항목                                   |
| ---- | -------------------------------------- |
| wp_4 | AppOpenAd 선로딩 제거 및 초기화 경량화 |
| wp_5 | Interstitial 트리거 범위 재정의        |
| wp_6 | 알림 권한 안내 suppress 플래그 도입    |

| ID   | 문제 / 개선 포인트                                                                                                                                                                  | 근거                                                                                                                                           | 작업 날짜 | 해결 상태 |
| ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------- | --------- | --------- |
| wp_4 | `AppOpenAdManager` 선로딩/표시 로직이 `app_initializer.dart`에 남아 있어 앱 최초 경험을 가로막으므로 관련 주석/코드를 삭제하고 초기화 경량화를 진행해야 함.                         | `lib/core/services/app_initializer.dart:19-35`<br>`lib/core/services/ad_service.dart:181-210`                                                  | -         | x         |
| wp_5 | `InterstitialAdManager.instance.logActionAndShowAd()` 호출이 바텀 내비 등 다수 지점에 분산돼 UX-critical 전환을 넘어 남용되고 있어, 트리거 지점을 재정의하고 로깅 기준을 좁혀야 함. | `lib/widgets/bottom_nav_bar.dart:20-40`<br>`lib/features/statistics/view/statistics.dart:80-340`<br>`lib/core/services/ad_service.dart:91-150` | -         | x         |
| wp_6 | 알림 권한 안내가 매 진입마다 나타나므로 `NotificationService`와 `CustomNotificationDialog` 사이에 `SharedPreferences` 기반 suppress flag를 추가해 2회 차부터는 숨겨야 함.           | `lib/core/services/notification_service.dart:13-120`<br>`lib/widgets/custom_notification_dialog.dart:5-60`                                     | -         | x         |

### 3. 테마/커스터마이징 확대

#### 작업 계획 ID 표

| ID   | 항목                                     |
| ---- | ---------------------------------------- |
| wp_7 | 팔레트 토큰 + 동적 Theme 구조 재편       |
| wp_8 | Settings 테마 컨트롤 분리 및 실시간 반영 |
| wp_9 | 색상 샌드박스 프리뷰 위젯 추가           |

| ID   | 문제 / 개선 포인트                                                                                                                                                            | 근거                                                                                                                        | 작업 날짜 | 해결 상태 |
| ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------- | --------- | --------- |
| wp_7 | `app_theme.dart`/`design_palette.dart`가 하드코딩 팔레트에 의존하므로 팔레트 토큰 + 동적 Scheme 생성 구조로 재편하고 사용자 선택 값은 `user_settings_provider`에 저장해야 함. | `lib/core/theme/app_theme.dart:1-200`<br>`lib/core/theme/design_palette.dart:1-160`                                         | -         | x         |
| wp_8 | `BasicSettingsSection`에 메인 색상/다크 모드가 분리되어 있지 않아 즉시 반영이 어려우므로, 개별 컨트롤과 `ProviderContainer` 브로드캐스트로 실시간 테마 갱신을 지원해야 함.    | `lib/features/settings/widgets/basic_setting_section.dart:9-120`<br>`lib/features/settings/view/settings_screen.dart:20-60` | -         | x         |
| wp_9 | 색상 샌드박스 요구 사항을 충족하기 위해 홈에서 실험적 색 조합을 즉시 프리뷰할 `sandbox_theme_preview.dart` 위젯을 추가해야 함.                                                | `document/devLog/8_운영데이터기반_개선사항도출__d.md:45-51`                                                                 | -         | x         |

### 4. 데이터/운영 지표 준비

#### 작업 계획 ID 표

| ID    | 항목                            |
| ----- | ------------------------------- |
| wp_10 | Analytics 이벤트 명세 정비      |
| wp_11 | Remote Config 키 운영 루틴 정립 |

| ID    | 문제 / 개선 포인트                                                                                                                                                                   | 근거                                                                                                                                                                   | 작업 날짜 | 해결 상태 |
| ----- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- | --------- |
| wp_10 | Analytics 이벤트(`create_transaction`, `tutorial_skipped`, `theme_changed`) 정의가 산발적이라 퍼널을 추적하기 어려우므로 명세를 통일하고 CHANGELOG에도 반영해야 함.                  | `lib/core/providers/expenses_provider.dart:51-90`<br>`lib/features/onboarding/view/budget_setup_screen.dart:30-80`<br>`lib/core/services/data_reset_service.dart:6-20` | -         | x         |
| wp_11 | Remote Config 키(`latest_version`, `min_supported_version`, `update_changelog`)가 산발적으로 관리돼 있어 버전 게이트가 흔들릴 수 있으므로 주기적 동기화와 리포트 루틴을 정의해야 함. | `lib/core/services/update_service.dart:45-90`<br>`lib/core/services/app_initializer.dart:19-35`                                                                        | -         | x         |

### 5. 문서 & 릴리스 체크리스트

#### 작업 계획 ID 표

| ID    | 항목                                 |
| ----- | ------------------------------------ |
| wp_12 | README / pubspec 버전 동기화         |
| wp_13 | 운영 데이터 문서 연계 및 재측정 계획 |

| ID    | 문제 / 개선 포인트                                                                                                                                             | 근거                                                        | 작업 날짜 | 해결 상태 |
| ----- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------- | --------- | --------- |
| wp_12 | README CHANGELOG와 `pubspec.yaml` 버전이 1.2.x에 머물러 있어 코드 변경과 릴리스 정보가 불일치하므로 1.3.0+??로 동기화해야 함.                                  | `README.md:53-122`<br>`pubspec.yaml:1-10`                   | -         | x         |
| wp_13 | 운영 데이터 기반 개선 사항(문서 8번)을 README 혹은 별도 PM 노트로 연결하지 않아 추적성이 떨어지므로 문서 링크와 재측정 계획을 릴리스 체크리스트에 포함해야 함. | `document/devLog/8_운영데이터기반_개선사항도출__d.md:40-55` | -         | x         |

## 코드 및 폴더 구조 진단

### 코드 및 폴더 구조 진단 ID 표

| ID   | 항목             |
| ---- | ---------------- |
| rf_2 | 리뷰 요청        |
| rf_3 | 통계 탭 토글     |
| rf_4 | 지출 리스트 갱신 |
| rf_5 | 카테고리 명칭    |
| rf_6 | 버전 관리        |

#### 코드 및 폴더 구조 진단 상세

| ID   | 문제 / 개선 포인트                                                                                                                                                                                                                        | 근거                                                              | 작업 날짜  | 해결 상태 |
| ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------- | ---------- | --------- |
| rf_2 | 리뷰 요청: 부정 피드백 전송 시 `Supabase.from('app_feedback')` insert payload가 `{'userid: <uuid>'}` 꼴로 들어가 `column "<uuid>" does not exist` 오류 위험. 키를 `'user_id'`로 고정하고 예외 로깅 추가 필요.                             | `lib/core/services/review_prompt_service.dart:134-145`            | 2025-11-07 | o         |
| rf_3 | 통계 탭 토글: `statisticsViewModelProvider`의 `changeExpenseType`이 `state.value!`를 즉시 참조해 초기 로딩 중 터치 시 NPE. `state.requireValueOrNull` 패턴 또는 `if (!state.hasValue) return;` 가드 추가.                                 | `lib/features/statistics/viewmodel/view_model.dart:30-35`         | -          | x         |
| rf_4 | 지출 리스트 갱신: `ExpensesListViewModel.build`에서 `ref.read(coreExpensesProvider.future)`로 데이터를 받아와 변화에 반응하지 못함. `ref.watch`로 교체하거나 `ref.listenManual`로 invalidate해야 지출 CRUD 후 화면이 자동 갱신됨.         | `lib/features/expense/viewmodel/expense_list_provider.dart:31-45` | -          | x         |
| rf_5 | 카테고리 명칭: `CategoryProviders.getCategoryName`이 하드코딩된 switch와 locale 문자열이 뒤섞여 있어 로컬라이징 누락/중복 가능성이 큼. `Category` 모델에 `localizedNameKey`를 추가하거나 l10n lookup map을 단일 소스로 통합 필요.         | `lib/core/providers/category_providers.dart:37-78`                | -          | x         |
| rf_6 | 버전 관리: 코드상 주요 변경(온보딩 제거, 테마 확장)이 예정되어 있으나 `pubspec.yaml` 버전이 1.2.5+15로 고정되어 있고 README도 동일. 릴리스 직전까지 버전/CHANGELOG 불일치가 계속되면 업데이트 게이트 Remote Config 조건과 충돌할 수 있음. | `pubspec.yaml:1-40`, `README.md:53-116`                           | -          | x         |

## 다음 액션 요약

- 위 작업 계획에 따라 티켓 분할 (온보딩 제거, 광고 개편, 테마 옵션, 측정/문서 정리) 후 각각에 대한 개발/QA 일정을 배정.
- 코드 진단 항목은 1.3.0 작업 중 병행 수정하여 추가 회귀를 막고, 수정 시 단위 테스트(`riverpod` notifier, repository mock 등)를 보완.
